---
title: "Case_study_mcp_2022100433"
output: html_document
---

```{r}
library(glycoTraitR)
```

# Example of pGlyco3 PSM input
```{r}
url <- "https://zenodo.org/records/17756830/files/pGlycoDB-GP-FDR-Pro-Quant-Site.txt?download=1"
download.file(url, "pglyco3_full.txt", mode = "wb")
gpsm <- read_pGlyco3_gpsm("pglyco3_full.txt")
```

```{r}
# preprocess the pGlyco3 gpsm matrix
gpsm_dir <- "~/glycoTraitR/simulation/data/pGlyco3_related/pGlycoDB-GP-FDR-Pro-Quant-Site.txt"
pGlyco3_gpsm <- read_pGlyco3_gpsm(gpsm_dir)

# obtain the summarized experiment object of trait matrices at the site / protein level
meta <- readRDS("~/glycoTraitR/simulation/meta_mcp_2022_100433.rds")

pGlyco3_gpsm
```


```{r}
pGlyco3_trait_se <- build_trait_se(
  pGlyco3_gpsm,
  from = "pGlyco3",
  motifs = NULL,
  level = "site",
  meta = meta
)

pGlyco3_res <- analyze_trait_changes(
  pGlyco3_trait_se, 
  group_col = "Diagnosis",
  group_levels = c(test = "Symptomatic", control = "Normal"),
  min_psm = 20)

pGlyco3_res
```

```{r}
# trait_level <- merge(
#   decipher_res[,1:2],
#   pGlyco3_res[,1:2],
#   by = c("trait", "level")
# )
# decipher_res %>% 
#   filter(trait %in% trait_level$trait) %>% 
#   filter(level %in% trait_level$level)
# pGlyco3_res %>%
#   filter(trait %in% trait_level$trait) %>% 
#   filter(level %in% trait_level$level)
```

# Visualization Plots
## histgram 
## boxplot 
```{r}
trait_se <- pGlyco3_trait_se
i <- sample(nrow(pGlyco3_res), 1)
trait <- pGlyco3_res[i,1]
level <- pGlyco3_res[i,2]

# trait <- "Neu5Ac"; level <- "GABR2"
# trait <- "Antennas"; level <- "LAMP2"
# trait <- "HexNAc"; level <-	"CNTN1"
gplots <- plot_trait_distribution(trait_se, 
                                  group_col = "Diagnosis", 
                                  group_levels = c(test = "Symptomatic", control = "Normal"), 
                                  trait, 
                                  level)
library(patchwork)
gplots[[1]] | gplots[[2]]
```


