% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/obtain_trait_tensor_from_gpsm_matrix.R
\name{obtain_trait_se}
\alias{obtain_trait_se}
\title{Generate peptide- or protein-level glycan trait matrices as a SummarizedExperiment.}
\usage{
obtain_trait_se(gpsm, from, user_defined_traits, level, meta)
}
\arguments{
\item{gpsm}{A data frame or tibble containing GPSM-level glycopeptide information.
Must include `Protein`, `Peptide`, `File`, and columns required by
`add_traits_to_gpsm()`.}

\item{from}{A character string specifying the glycan annotation format used in the GPSM
input. Valid values:

* `"decipher"` — WURCS-formatted glycan structures
* `"pGlyco3"` — pGlyco-format glycan structures}

\item{user_defined_traits}{A named list specifying user-defined glycan structural motifs for trait
detection. See `add_traits_to_gpsm()` for the structure and examples.}

\item{level}{A character string indicating the summarization level:

* `"site"` — glycan traits summarized at peptide level
* `"protein"` — glycan traits summarized at protein level

Determines the row dimension of each assay matrix.}

\item{meta}{A data frame describing sample-level metadata. Must contain a `file` column
whose entries match the `File` column of `gpsm`. Additional metadata columns
are preserved and attached to the resulting `colData`.}
}
\value{
A `SummarizedExperiment` object containing:

* **assays** — named list of trait matrices (`trait × PSM`)
* **rowData** — data frame containing peptides or proteins used as row labels
* **colData** — metadata aligned to PSM identifiers

Row and column names follow the structure required for downstream tensor
construction and trait modeling.
}
\description{
This function aggregates glycan trait annotations from a GPSM table and
constructs a `SummarizedExperiment` object containing trait-by-sample matrices.
Glycan traits are first computed at the GPSM level (via `add_traits_to_gpsm()`),
and are then summarized at either the glycosylation *site* level (peptide-based)
or *protein* level. Each trait is represented as a matrix whose rows correspond
to sites or proteins, and whose columns correspond to PSM identifiers.
}
\details{
Construct a SummarizedExperiment Object Containing Glycan Trait Matrices


The input `gpsm` must have glycopeptide-spectrum-match (GPSM) records containing:

* **Protein** — protein identifiers
* **Peptide** — peptide sequence (used as glycosylation site proxy)
* **File** — sample or raw file name for linking PSMs to metadata
* Any additional GPSM-level metadata

Glycan traits are first appended using [`add_traits_to_gpsm()`], which parses
glycan structures according to the search engine specification (`from`) and
computes user-defined or default structural traits. Each PSM is assigned a
unique `psm_id` to ensure correct construction of the assay matrices.

## Trait Matrix Generation
For each glycan trait column:

1. The GPSM table is reshaped into a long format indexed by `psm_id`.
2. A wide-format matrix is created where **rows correspond to either:**
   * peptides (`level = "site"`), or
   * proteins (`level = "protein"`)
3. Columns correspond to unique PSM identifiers.
4. Values represent trait intensities for each PSM.

## Output Structure
The returned `SummarizedExperiment` contains:

* **assays** — a list of matrices, one per glycan trait
* **rowData** — a data frame containing peptide or protein names
* **colData** — sample-level metadata aligned to PSMs

This format allows downstream operations such as differential analysis,
tensor conversion, visualization, and multi-level trait modeling.
}
\examples{
\dontrun{
# Example GPSM table
gpsm <- data.frame(
  Protein = c("P1", "P2"),
  Peptide = c("PEPTIDE1", "PEPTIDE2"),
  GlycanStructure = c("WURCS=...", "WURCS=..."),
  count = c(3, 1),
  File = c("rawA", "rawB")
)

# Example metadata
meta <- data.frame(
  file = c("rawA", "rawB"),
  condition = c("A", "B")
)

# Example user-defined traits
user_traits <- list(
  MotifA = list(node = c("H","N"), edge = "a-b")
)

# Construct peptide-level trait SE
se <- obtain_trait_se(
  gpsm,
  from = "decipher",
  user_defined_traits = user_traits,
  level = "site",
  meta = meta
)

se
}

}
\seealso{
* [`add_traits_to_gpsm()`] — compute GPSM-level glycan traits
* `SummarizedExperiment::SummarizedExperiment`
}
